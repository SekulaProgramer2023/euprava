<nav class="navbar">
  <div class="navbar-left">
    <img src="https://www.scns.rs/wp-content/uploads/2024/03/SC-Novi-Sad-logo-horizontalni.png" alt="Logo" class="logo">
    <a [routerLink]="['/menza/home']" class="nav-link" id="dom">Stranica Menza</a>
    <a [routerLink]="['/domovi/dogadjaj']" class="nav-link" id="dogadjaji">DogaÄ‘aji</a>
  </div>

  <div class="navbar-center">
    <span class="navbar-title">Studentski domovi</span>
  </div>

  <div class="navbar-right">
    <div class="profile-container" (click)="toggleDropdown()">
      <img src="https://static.vecteezy.com/system/resources/previews/005/544/718/non_2x/profile-icon-design-free-vector.jpg" alt="Profil" class="profile-pic">
      
      <!-- Dropdown meni -->
      <div class="dropdown-menu" *ngIf="dropdownOpen">
        <button (click)="goToProfile($event)">Profile</button>
        <button (click)="logout($event)">Logout</button>
      </div>
    </div>
  </div>
</nav>


<div class="home-container">
  <h1>RaspoloÅ¾ivost soba</h1>

  <div class="cards-container">
  <div *ngFor="let soba of sobe" class="soba-card" [ngClass]="soba.IsFree ? 'slobodna' : 'zauzeta'">
  <h3>Soba {{ soba.roomNumber }}</h3>
  <p>Status: {{ soba.IsFree ? 'Slobodna' : 'Zauzeta' }}</p>
  <p>Kapacitet: {{ soba.capacity }}</p>

   <!-- Ako je role User i ovo je njegova soba -->
    <button 
      *ngIf="role === 'User' && soba.users.includes(userId)" 
      class="kvar-btn"
      (click)="openKvarModal(soba.id)">
      Prijavi kvar
    </button>

  <!-- Prikaz studenata ako je admin -->
<div *ngIf="role === 'Admin' && soba.users.length > 0" class="students-container">
  <p style="text-align: center;">Studenti u sobi:</p>
  <div class="students-tags">
    <span *ngFor="let userId of soba.users" class="student-tag">
      ğŸ‘¤ {{ userMap[userId]?.name }} {{ userMap[userId]?.surname }}
    </span>
  </div>
</div>

<!-- Prikaz kvarova samo za admina -->
<div *ngIf="role === 'Admin' && (kvarMap[soba.id]?.length ?? 0) > 0" class="kvar-container">
  <p>Kvarovi u sobi</p>
  <ul>
    <li *ngFor="let kvar of kvarMap[soba.id]; let i = index">
  <span class="kvar-link" (click)="openKvarDetailModal(kvar)">
    ğŸ› ï¸ Kvar {{ i + 1 }}
  </span>
</li>

  </ul>
</div>

<!-- Modal za detalje kvara -->
<div class="modal-backdrop" *ngIf="showKvarDetailModal">
  <div style="color: black" class="modal">
    <h2>Detalji kvara</h2>

    <!-- Provera da selectedKvar postoji -->
    <div *ngIf="selectedKvar">
      <p><strong>Kvar ID:</strong> {{ selectedKvar.id }}</p>
      <p><strong>Opis:</strong> {{ selectedKvar.description }}</p>
      <p><strong>Status:</strong> {{ selectedKvar.status ? 'ReÅ¡en âœ…' : 'NereÅ¡en âŒ' }}</p>
    </div>

    <div class="modal-actions" style="margin-top:15px; display:flex; gap:10px; justify-content:flex-end;">
      <button 
        *ngIf="selectedKvar && !selectedKvar.status" 
        (click)="resolveSelectedKvar()">
        OznaÄi kao reÅ¡en
      </button>
      <button (click)="closeKvarDetailModal()">Zatvori</button>
    </div>
  </div>
</div>





  <!-- Dugme samo ako je role == user -->
  <button class="useliSe" 
      *ngIf="role === 'User'" 
      [disabled]="!soba.IsFree"
      (click)="useliStudenta(soba.id)">
    Useli se
  </button>
</div>


</div>


<!-- Modal za greÅ¡ke -->
<div class="modal-backdrop" *ngIf="showErrorModal">
  <div class="modal">
    <h2>GreÅ¡ka</h2>
    <p>{{ errorMessage }}</p>
    <button (click)="closeErrorModal()">OK</button>
  </div>
</div>


<!-- Modal za prijavu kvara -->
<div class="modal-backdrop" *ngIf="showKvarModal">
  <div class="modal">
    <h2>Prijavi kvar</h2>
    <textarea [(ngModel)]="kvarDescription" placeholder="Unesi opis kvara..." rows="15" style="width:100%;"></textarea>
    <div class="modal-actions" style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
      <button (click)="submitKvar()">PoÅ¡alji</button>
      <button (click)="closeKvarModal()">OtkaÅ¾i</button>
    </div>
  </div>
</div>